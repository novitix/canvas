name: Docker Image CI & Deploy to Swift5 Server

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Log in to Docker Hub
        run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login --username "${{ secrets.DOCKER_USERNAME }}" --password-stdin

      - name: Build and Push Frontend
        run: |
          docker build -t novitix/canvas-client:latest ./client
          docker push novitix/canvas-client:latest

      - name: Build and Push Backend
        run: |
          docker build -t novitix/canvas-server:latest ./server
          docker push novitix/canvas-server:latest

      # - name: SSH into VPS and deploy
      #   run: |
      #     mkdir -p ~/.ssh
      #     echo "${{ secrets.VPS_SSH_KEY }}" > ~/.ssh/id_ed25519
      #     chmod 600 ~/.ssh/id_ed25519
      #     ssh-keyscan -H ${{ secrets.VPS_HOST }} >> ~/.ssh/known_hosts

      #     ssh -i ~/.ssh/id_ed25519 user@${{ secrets.VPS_HOST }} << 'EOF'
      #       cd /path/to/docker-compose
      #       docker compose pull
      #       docker compose up -d
      #     EOF
